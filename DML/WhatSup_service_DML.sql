-- 이지행
DELIMITER //

CREATE TRIGGER before_faq_insert
BEFORE INSERT ON faq FOR EACH ROW
BEGIN
    DECLARE user_role_check VARCHAR(15);
    SELECT role INTO user_role_check
    FROM users
    WHERE user_id = NEW.administrator_id;
    IF user_role_check = 'user' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = '오류: 일반 사용자(user role)는 FAQ를 등록할 수 없습니다. 관리자 권한이 필요합니다.';
    END IF;
END;
//

DELIMITER ;


INSERT INTO faq (administrator_id, category, question, answer) VALUES
(1, '제품 추천', '피로를 많이 느끼는데, 컨디션 회복에 가장 도움을 주는 제품은 무엇이며, 어떤 연령대에 추천되나요?', 
    '고객 리뷰에 따르면, 간 기능 개선에 도움을 주는 **N-아세틸시스테인**이나 피로 회복 성분인 **타우린** 등이 긍정적인 후기를 받고 있습니다. N-아세틸시스테인은 20세 이상 남녀 모두에게 추천됩니다.'),
    
(2, '제품 효능', '숙면을 위한 제품인 **멜라토닌**이나 **발레리안 루트** 복용 후 [수면장애]가 실제로 개선되었다는 후기가 많나요?', 
    '네, **멜라토닌**과 **발레리안 루트** 모두 긍정적인 리뷰가 다수 확인되었습니다. 꾸준히 복용 시 효과를 보실 수 있습니다.'),
    
(3, '제품 효능', '평소에 [소화장애]가 심한데, 식사 후 더부룩함을 줄여준다는 **베타인 HCl**이나 **소화효소**의 효능이 궁금합니다.', 
    '**베타인 HCl**과 **소화효소** 모두 소화 불량이나 더부룩함 개선에 도움을 준다는 평가가 많습니다. 식후 불편함이 줄었다는 후기가 가장 많으며, **생강 추출물**도 소화 기능에 도움을 줄 수 있습니다.'),
    
(4, '제품 효능', '계단을 오르내릴 때 [관절뼈통증]이 느껴집니다. **MSM**과 **보스웰리아** 중 어떤 것을 선택해야 하나요?', 
    '**MSM**은 관절 건강 전반에, **보스웰리아**는 특히 40세 이상에게 추천되며 관절 통증 완화에 대한 리뷰가 많습니다. 두 제품 모두 관절 건강 성분을 포함하고 있어 통증 완화에 효과적입니다.'),
    
(5, '제품 효능', '요즘 [스트레스]가 심한데, 기분 완화에 도움을 주는 **GABA**와 **아슈와간다**의 차이는 무엇인가요?', 
    '**GABA**는 신경 안정에 직접적으로 관여하여 하루를 편안하게 해준다는 후기가 많고, **아슈와간다**는 스트레스 완화에 도움을 주는 아답토젠(Adaptogen) 성분으로, 전반적인 신체 반응을 개선합니다.'),
    
(6, '제품 효능', '컴퓨터 작업을 오래 해서 [시력저하]와 눈의 피로를 느낍니다. **루테인**과 **빌베리 추출물**의 효능을 알고 싶습니다.', 
    '**루테인**은 전반적인 눈 건강 유지 및 노화로 인한 시력 감소에, **빌베리 추출물**은 특히 [눈 피로 개선]에 중점을 두고 있습니다. 두 제품 모두 40세 이상에게 추천되는 눈 건강 제품입니다.'),
    
(7, '제품 효능', '환절기마다 감기에 잘 걸리는데, [면역저하] 개선에 효과적인 **베타글루칸**이나 **비타민 C** 같은 제품이 있나요?', 
    '네, **베타글루칸**과 **비타민 C**, **비타민 A** 등은 [면역력 향상], [감기에 잘 안 걸려요]와 같은 평가를 받은 제품들입니다. 면역 기능을 강화하고 컨디션 안정에 도움을 줄 수 있습니다.'),
    
(8, '제품 효능', '잦은 [두통]으로 고통받고 있습니다. **멜라토닌**이나 **버터버**, **피버퓨** 등 두통 완화에 도움을 받았다는 실제 후기가 있나요?', 
    '네, **버터버**와 **피버퓨**는 두통 완화에 효과가 있다는 후기가 많습니다. **멜라토닌**은 수면 개선을 통해 긴장성 두통 완화에 간접적으로 도움을 주었다는 후기가 확인되었습니다.'),
    
(9, '제품 효능', '피부 트러블과 [피부문제]가 고민입니다. **비오틴**이나 **콜라겐**, **히알루론산** 중 어떤 제품이 가장 효과적인가요?', 
    '**비오틴**은 주로 머리카락 건강에, **콜라겐**과 **히알루론산**은 [피부 탄력] 및 [피부 보습]에 도움을 주어 피부 트러블이 줄었다는 긍정적인 평가가 확인됩니다. 콜라겐과 히알루론산은 40세 이상 여성에게 추천됩니다.'),
    
(10, '제품 사용', '만 10세 어린이가 복용 가능한 제품 중 [면역 강화]와 [뼈 건강]에 도움이 되는 제품은 무엇인가요?', 
    '10세 이상 복용 가능한 제품 중 [면역 강화]에는 **비타민 C**, **아연** 등이, [뼈 건강]에는 **비타민 D3**, **칼슘** 등이 있습니다. 이 제품들은 전 연령층에게 추천되며, 어린이에게도 안전합니다.');

INSERT INTO qna (user_id, question_title, question_content, answer_content, status) VALUES

-- 1. 답변 완료 (N-아세틸시스테인)
(11, 'N-아세틸시스테인과 피로 회복', 'N-아세틸시스테인(간 기능 개선)을 복용 중입니다. 술을 마신 다음 날 피로가 덜한 것 같은데, 원래 피로 회복에도 도움이 되나요?', 
    'N-아세틸시스테인은 간 기능 개선을 통해 간의 해독 작용을 돕기 때문에, 고객님처럼 술을 드신 후 숙취 및 피로 회복에 간접적으로 도움을 줄 수 있습니다.', '답변완료'),
    
-- 2. 답변 완료 (글루코사민 복용 시점)
(18, '글루코사민 복용 시점 문의', '글루코사민을 먹고 있는데, 식전에 먹어야 할지 식후에 먹어야 할지 헷갈립니다. 가장 효과적인 복용 시점을 알려주세요.', 
    '글루코사민은 일반적으로 식사와 관계없이 복용 가능하지만, 위장 장애를 최소화하기 위해 식사 직후 또는 식사 중 복용하는 것을 권장드립니다.', '답변완료'),
    
-- 3. 답변 완료 (멜라토닌 부작용)
(25, '멜라토닌 복용 후 졸림 현상', '멜라토닌을 먹으면 다음 날 아침까지 심하게 졸립니다. 정상인가요? 복용량을 줄여야 할까요?', 
    '멜라토닌은 수면 호르몬이므로 복용 후 잔여 졸림(hangover effect)이 느껴질 수 있습니다. 복용량을 현재의 절반으로 줄여보시고, 그래도 증상이 지속되면 복용을 중단하시고 전문가와 상의해주세요.', '답변완료'),
    
-- 4. 답변 대기 (재고/재입고 문의 - answer_content에 NULL 허용)
(32, '비타민 C 재고 문의', '비타민 C 재고가 241개로 보이는데, 다음 달 재입고 예정일이 궁금합니다. 대량 구매하고 싶습니다.', 
    NULL, '답변대기'), 
    
-- 5. 답변 완료 (스트레스 완화)
(40, '스트레스 완화 제품 후기 질문', 'GABA를 복용하고 있는데, 스트레스 완화 효과는 만족스럽지만, 같이 먹으면 좋다는 다른 제품이 있나요?', 
    '스트레스 완화 효과를 더욱 높이고 싶으시다면, 긴장 완화에 도움을 주는 **테아닌**이나 전반적인 심신 안정에 좋은 **카모마일**을 함께 복용해보시는 것을 추천드립니다.', '답변완료'),
    
-- 6. 답변 완료 (반품 상태)
(44, '반품 진행 상태 문의', '10월 17일에 제품 파손으로 반품 요청했는데, 지금 상태가 [요청접수]에서 바뀌지 않고 있습니다. 언제쯤 [승인완료]되나요?', 
    '파손 건은 검토에 시간이 소요될 수 있습니다. 현재 고객님의 반품 건은 담당 부서에서 확인 중이며, 금일 중으로 [승인완료] 처리 후 안내 문자를 발송해 드리겠습니다.', '답변완료'),
    
-- 7. 답변 완료 (루테인/빌베리)
(15, '루테인과 빌베리 병행 복용', '루테인과 빌베리 추출물을 같이 먹어도 눈 건강에 문제가 없을까요? 두 성분이 겹치지 않나요?', 
    '루테인은 황반 건강 유지에, 빌베리는 눈 피로 개선에 중점을 둡니다. 두 성분은 상호 보완적이므로 함께 복용하셔도 눈 건강에 시너지를 낼 수 있어 괜찮습니다.', '답변완료'),
    
-- 8. 답변 대기 (배송지 변경 - answer_content에 NULL 허용)
(29, '배송지 변경 요청', '주문 번호 123456의 배송지를 서울에서 경기도로 변경하고 싶습니다. 아직 [취소요청] 상태입니다.', 
    NULL, '답변대기'), 
    
-- 9. 답변 완료 (히알루론산/콜라겐)
(50, '히알루론산과 콜라겐의 차이', '히알루론산과 콜라겐 둘 다 피부에 좋다고 하는데, 정확히 어떤 차이가 있나요? 40대 여성에게는 어떤 것이 더 필요할까요?', 
    '히알루론산은 피부에 수분을 끌어당겨 [피부 보습]에 중점을 두고, 콜라겐은 [피부 탄력] 유지에 필수적인 단백질입니다. 40대에는 두 가지 모두 필요하며, 함께 복용 시 시너지를 기대할 수 있습니다.', '답변완료'),
    
-- 10. 답변 완료 (최대 복용 연령)
(37, '최대 복용 연령 초과 관련', '저희 어머니가 80세인데, 대부분 제품의 최대 연령이 150세로 되어 있습니다. 연세가 많으신 분도 안전하게 복용할 수 있나요?', 
    '제품의 최대 연령 150세는 일반적인 성인에게 해당되는 표기입니다. 고령의 경우, 기저 질환이나 복용 중인 약물과의 상호작용 가능성이 있으므로 반드시 전문가 또는 주치의와 상담 후 복용하시는 것을 권장드립니다.', '답변완료');

INSERT INTO coupons (code, name, discount_value, expire_date) VALUES
('SLEEP_BETTER_8K', '숙면 유도 제품 8천원 할인 (멜라토닌, 발레리안 루트 등)', 8000, '2026-03-01'),
('JOINT_CARE_12K', '관절뼈 통증 완화 제품 1만 2천원 할인 (MSM, 보스웰리아 등)', 12000, '2026-06-30'),
('LIVER_HEALTH_10K', '간 기능 개선 제품 1만원 할인 (N-아세틸시스테인, 밀크시슬)', 10000, '2026-04-15'),
('DIGEST_AID_5K', '소화 장애 개선 제품 5천원 할인 (베타인 HCl, 소화효소, 펩신)', 5000, '2026-01-31'),
('IMMUNE_UP_7K', '면역력 강화 제품 7천원 할인 (비타민 C, 베타글루칸, 아연)', 7000, '2026-02-28'),
('VISION_PLUS_9K', '시력저하/눈 피로 개선 제품 9천원 할인 (루테인, 빌베리 추출물)', 9000, '2026-05-20'),
('SKIN_BEAUTY_15K', '피부 탄력/보습 제품 1만 5천원 할인 (콜라겐, 히알루론산, 세라마이드)', 15000, '2026-07-31'),
('FATIGUE_RECOVERY_6K', '피로 회복/에너지 대사 제품 6천원 할인 (비타민 B군 복합체, 타우린)', 6000, '2026-04-01'),
('HEADACHE_FREE_4K', '두통 완화 제품 4천원 할인 (버터버, 피버퓨)', 4000, '2025-12-31'),
('STRESS_BALANCE_11K', '스트레스/긴장 완화 제품 1만 1천원 할인 (GABA, 로디올라 로제아)', 11000, '2026-08-31');

INSERT INTO user_coupons (user_id, coupon_id, created_at, updated_at, expired_at, used_at) VALUES
-- 1. 신규 회원 쿠폰 발급 (미사용)
(11, 1, '2025-10-13 10:00:00', '2025-10-13 10:00:00', '2026-04-30 23:59:59', NULL),

-- 2. 첫 구매 쿠폰 발급 (사용 완료)
(18, 2, '2025-09-01 15:30:00', '2025-09-10 11:00:00', '2026-03-31 23:59:59', '2025-09-10 11:00:00'),

-- 3. 주말 특가 쿠폰 발급 (유효기간 만료)
(25, 3, '2025-10-01 08:00:00', '2025-10-01 08:00:00', '2025-10-05 23:59:59', NULL), 

-- 4. 이달의 베스트 쿠폰 발급 (미사용)
(32, 4, '2025-10-13 14:00:00', '2025-10-13 14:00:00', '2025-11-30 23:59:59', NULL),

-- 5. 생일 쿠폰 발급 (사용 완료)
(40, 5, '2025-05-15 09:00:00', '2025-06-01 16:20:00', '2026-12-31 23:59:59', '2025-06-01 16:20:00'),

-- 6. 오메가-3 등 특정 제품군 할인 쿠폰 발급 (미사용)
(14, 6, '2025-10-13 15:00:00', '2025-10-13 15:00:00', '2026-01-31 23:59:59', NULL),

-- 7. 면역력 강화 쿠폰 발급 (사용 완료)
(22, 7, '2025-09-20 10:30:00', '2025-10-01 12:45:00', '2026-05-31 23:59:59', '2025-10-01 12:45:00'),

-- 8. 수면 유도 제품 할인 쿠폰 발급 (미사용)
(45, 8, '2025-10-13 16:00:00', '2025-10-13 16:00:00', '2025-10-25 23:59:59', NULL),

-- 9. 스트레스 완화 쿠폰 발급 (사용 완료)
(37, 9, '2025-08-05 11:00:00', '2025-08-15 14:00:00', '2026-06-30 23:59:59', '2025-08-15 14:00:00'),

-- 10. VIP 전용 쿠폰 발급 (미사용)
(50, 10, '2025-07-01 09:00:00', '2025-07-01 09:00:00', '2026-02-28 23:59:59', NULL);

DELIMITER //

CREATE TRIGGER before_expert_contents_insert
BEFORE INSERT ON expert_contents FOR EACH ROW
BEGIN
    DECLARE user_role_check VARCHAR(15);

    SELECT role INTO user_role_check
    FROM users
    WHERE user_id = NEW.administrator_id;

    -- 역할이 'user'인 경우 삽입을 취소하고 오류 메시지를 반환
    IF user_role_check = 'user' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = '오류: 일반 사용자(user role)는 전문가 콘텐츠를 등록할 수 없습니다. 관리자 권한이 필요합니다.';
    END IF;
END;
//

DELIMITER ;

INSERT INTO expert_contents (administrator_id, title, video_link, category, expert_job) VALUES
(1, '피로에 좋은 N-아세틸시스테인, 간 건강 지키는 법', 'https://youtube.com/video_nac_liver', '간기능저하/피로', '약사'),
(2, '밤마다 뒤척이는 수면장애, 멜라토닌과 발레리안 루트의 올바른 복용법', 'https://youtube.com/video_sleep_aid', '수면장애', '의사'),
(3, '40대 이상 주목! MSM, 글루코사민으로 관절 통증 줄이는 운동법', 'https://youtube.com/video_joint_pain', '관절뼈통증', '재활 트레이너'),
(4, '소화 불량 해결사: 베타인 HCl과 소화효소, 언제 먹어야 효과적일까?', 'https://youtube.com/video_digestion_fix', '소화장애', '영양사'),
(5, '스트레스 관리 꿀팁: GABA와 아슈와간다로 긴장 완화하는 법', 'https://youtube.com/video_stress_relief', '스트레스', '심리 상담사'),
(6, '잦은 두통, 버터버와 피버퓨 성분이 두통을 완화하는 원리', 'https://youtube.com/video_headache_cure', '두통', '약사'),
(7, '가을철 면역력 저하 탈출! 비타민 C와 아연의 시너지 효과', 'https://youtube.com/video_immunity_boost', '면역저하', '의사'),
(8, '장시간 컴퓨터 사용, 루테인과 빌베리로 시력 저하 막는 방법', 'https://youtube.com/video_vision_care', '시력저하', '안과 전문의'),
(9, '콜라겐, 히알루론산, 비오틴: 피부 문제를 위한 영양제 조합 가이드', 'https://youtube.com/video_skin_health', '피부문제', '피부과 전문의'),
(10, '에너지와 활력! 비타민 B군 복합체가 만성 피로를 개선하는 원리', 'https://youtube.com/video_vitaminb_fatigue', '피로', '내과 의사');

INSERT INTO sns_share (user_id, shared_link, shared_platform) VALUES
(11, 'https://blog.naver.com/post/sleep_aid', '블로그'),
(18, 'https://instagram.com/p/B_vitaminb_review', '인스타그램'),
(25, 'https://twitter.com/status/17128692345', 'X (트위터)'),
(32, 'https://facebook.com/share/joint_product', '페이스북'),
(40, 'https://kakaostory.com/feed/stress_product', '카카오스토리'),
(44, 'https://instagram.com/p/C_vision_care_tip', '인스타그램'),
(15, 'https://blog.naver.com/post/coupon_event', '블로그'),
(29, 'https://band.us/band/immuneboost', '밴드'),
(50, 'https://facebook.com/share/expert_video', '페이스북'),
(37, 'https://twitter.com/status/17128692346', 'X (트위터)');
